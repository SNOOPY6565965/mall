{"ast":null,"code":"import \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/dialog/style\";\nimport _Dialog from \"vant/es/dialog\";\nimport \"core-js/modules/es.array.push.js\";\nimport { getProComments, getProDetail } from '@/api/product';\nimport defaultImg from '@/assets/img/defaultImg.webp';\nimport CountBox from '@/components/CountBox.vue';\nimport { addCart } from '@/api/cart.js';\nexport default {\n  name: 'GoodsPage',\n  data() {\n    return {\n      detail: {},\n      images: [],\n      page: 1,\n      total: 0,\n      // 评价总数\n      commentList: [],\n      // 评价列表\n      defaultImg,\n      showPannel: false,\n      // 控制弹层的 显示隐藏\n      mode: 'cart',\n      addCount: 1,\n      // 数字框绑定的数据\n      cartTotal: 0 // 购物车角标\n    };\n  },\n  computed: {\n    goodsId() {\n      return this.$route.params.id;\n    }\n  },\n  created() {\n    this.getDetail();\n    this.getComments();\n  },\n  methods: {\n    onChange() {\n      this.page += 1;\n      if (this.page > this.images.length) {\n        this.page = 1;\n      }\n    },\n    async getDetail() {\n      const {\n        data: {\n          detail\n        }\n      } = await getProDetail(this.goodsId);\n      this.detail = detail;\n      this.images = detail.goods_images;\n    },\n    async getComments() {\n      const {\n        data: {\n          list,\n          total\n        }\n      } = await getProComments(this.goodsId, 5);\n      this.commentList = list;\n      this.total = total;\n    },\n    addFn() {\n      this.mode = 'cart';\n      this.showPannel = true;\n    },\n    buyFn() {\n      this.mode = 'buyNow';\n      this.showPannel = true;\n    },\n    async addCart() {\n      // 判断 token 是否存在\n      // 1.如果token不存在，弹确认框\n      // 2.如果token存在，继续请求操作\n      if (!this.$store.getters.token) {\n        // 弹确认框\n        _Dialog.confirm({\n          title: '温馨提示',\n          message: '此时需要先登录才能继续操作哟！',\n          confirmButtonText: '去登录',\n          cancelButtonText: '再逛逛'\n        }).then(() => {\n          // 如果希望，跳转到登录 => 登录后能 跳转 回来，需要在跳转时去携带参数（当前的路径地址）\n          // this.$route.fullPath：会包含查询参数\n          this.$router.replace({\n            path: '/login',\n            query: {\n              backUrl: this.$route.fullPath\n            }\n          });\n        }).catch(() => {});\n        return;\n      }\n      const {\n        data\n      } = await addCart(this.goodsId, this.addCount, this.detail.skuList[0].goods_sku_id);\n      this.cartTotal = data.cartTotal;\n      _Toast('加入购物车');\n      this.showPannel = false;\n      console.log(this.cartTotal);\n    },\n    goBuyNow() {\n      this.$router.push({\n        path: '/pay',\n        query: {\n          mode: 'buyNow',\n          goodsId: this.goodsId,\n          goodsSkuId: this.detail.skuList[0].goods_sku_id,\n          goodNum: this.addCount\n        }\n      });\n    }\n  },\n  components: {\n    CountBox\n  }\n};","map":{"version":3,"names":["getProComments","getProDetail","defaultImg","CountBox","addCart","name","data","detail","images","page","total","commentList","showPannel","mode","addCount","cartTotal","computed","goodsId","$route","params","id","created","getDetail","getComments","methods","onChange","length","goods_images","list","addFn","buyFn","$store","getters","token","_Dialog","confirm","title","message","confirmButtonText","cancelButtonText","then","$router","replace","path","query","backUrl","fullPath","catch","skuList","goods_sku_id","_Toast","console","log","goBuyNow","push","goodsSkuId","goodNum","components"],"sources":["src/views/goods/index.vue"],"sourcesContent":["<!-- 商品详情 - 一级路由 -->\r\n<template>\r\n  <div class=\"goods\">\r\n    <van-nav-bar\r\n      :v-model=\"goodsId\"\r\n      title=\"商品详情页\"\r\n      left-arrow\r\n      @click-left=\"$router.push('/searchList')\"\r\n    />\r\n    <van-swipe @change=\"onChange()\" :autoplay=\"2000\">\r\n      <van-swipe-item v-for=\"(item,index) in images\" :key=\"index\">\r\n        <img :src=\"item.external_url\" class=\"imgUrl\">\r\n        <span class=\"page\">{{ page }} / {{ images.length }}</span>\r\n      </van-swipe-item>\r\n    </van-swipe>\r\n    <div class=\"price\">\r\n      <span class=\"min\">￥{{ detail.goods_price_min }}</span>\r\n      <span class=\"max\">￥{{ detail.line_price_max }}</span>\r\n      <span class=\"sales\">已售{{ detail.goods_sales }}件</span>\r\n    </div>\r\n    <p class=\"name\">{{ detail.goods_name }}</p>\r\n    <p class=\"icon\">\r\n      <van-icon name=\"passed\"/>\r\n      七天无理由退货\r\n      <van-icon name=\"passed\"/>\r\n      48小时发货\r\n      <van-icon name=\"arrow\"/>\r\n    </p>\r\n    <p class=\"p\">\r\n      <span>商品评价({{ total }}条)</span>\r\n      <span class=\"p_sp\">\r\n        查看更多\r\n      <van-icon name=\"arrow\"/>\r\n      </span>\r\n    </p>\r\n    <div class=\"ul\">\r\n      <ul v-for=\"item in commentList\" :key=\"item.comment_id\">\r\n        <li>\r\n          <img :src=\"item.user.avatar_url || defaultImg\" class=\"defaultImg\">\r\n          <span class=\"li_sp\">{{ item.user.nick_name }}</span>\r\n          <van-rate size=16px gutter=2px :value=\"item.score / 2\" :count=\"6\" color=\"#ffd21e\" void-color=\"#fed\"/>\r\n          <p>{{ item.content }}</p>\r\n          <p class=\"p2\">{{ item.create_time }}</p>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <!-- 商品描述 -->\r\n    <div v-html=\"detail.content\" class=\"content\"></div>\r\n    <!-- 底部 -->\r\n    <van-tabbar active-color=\"black\" inactive-color=\"black\" route fixed>\r\n      <van-tabbar-item icon=\"wap-home-o\" to=\"/first\">首页</van-tabbar-item>\r\n      <van-tabbar-item icon=\"shopping-cart-o\" to=\"/shopping\" class=\"shopping-cart\">购物车</van-tabbar-item>\r\n      <p class=\"cart\" v-if=\"cartTotal > 0\">{{ cartTotal }}</p>\r\n      <button class=\"btn1\" @click=\"addFn()\">加入购物车</button>\r\n      <button class=\"btn2\" @click=\"buyFn()\">立即购买</button>\r\n    </van-tabbar>\r\n    <!-- 加入购物车/立即购买 共用的弹层 -->\r\n    <van-action-sheet\r\n    v-model=\"showPannel\"\r\n    :title = \"mode === 'cart' ? '加入购物车' : '立即购买'\">\r\n      <div class=\"sheet\">\r\n        <img :src=\"detail.goods_image\" class=\"sheetImg\">\r\n        <p class=\"sheet-p1\"><span>￥</span>{{ detail.goods_price_min }}</p>\r\n        <p class=\"sheet-p2\">库存{{ detail.stock_total }}</p>\r\n        <div class=\"count\">\r\n          <span>数量</span>\r\n          <!-- v-model应用于组件时，本质上是 :value 和 @input 的简写 -->\r\n          <CountBox v-model=\"addCount\" class=\"count-box\"></CountBox>\r\n        </div>\r\n        <div class=\"stock\">\r\n          <!-- 有库存 -->\r\n          <div v-if=\"detail.stock_total > 0\" @click=\"addCart()\">\r\n            <button v-if=\"mode === 'cart'\" class=\"btn-sheet1\">加入购物车</button>\r\n            <button v-else class=\"btn-sheet2\" @click=\"goBuyNow()\">立即购买</button>\r\n          </div>\r\n          <!-- 没有库存 -->\r\n          <div class=\"none\" v-else>该商品已售完</div>\r\n        </div>\r\n      </div>\r\n    </van-action-sheet>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getProComments, getProDetail } from '@/api/product'\r\nimport defaultImg from '@/assets/img/defaultImg.webp'\r\nimport CountBox from '@/components/CountBox.vue'\r\nimport { Dialog, Toast } from 'vant'\r\nimport { addCart } from '@/api/cart.js'\r\nexport default {\r\n  name: 'GoodsPage',\r\n  data () {\r\n    return {\r\n      detail: {},\r\n      images: [],\r\n      page: 1,\r\n      total: 0, // 评价总数\r\n      commentList: [], // 评价列表\r\n      defaultImg,\r\n      showPannel: false, // 控制弹层的 显示隐藏\r\n      mode: 'cart',\r\n      addCount: 1, // 数字框绑定的数据\r\n      cartTotal: 0 // 购物车角标\r\n    }\r\n  },\r\n  computed: {\r\n    goodsId () {\r\n      return this.$route.params.id\r\n    }\r\n  },\r\n  created () {\r\n    this.getDetail()\r\n    this.getComments()\r\n  },\r\n  methods: {\r\n    onChange () {\r\n      this.page += 1\r\n      if (this.page > this.images.length) {\r\n        this.page = 1\r\n      }\r\n    },\r\n    async getDetail () {\r\n      const { data: { detail } } = await getProDetail(this.goodsId)\r\n      this.detail = detail\r\n      this.images = detail.goods_images\r\n    },\r\n    async getComments () {\r\n      const { data: { list, total } } = await getProComments(this.goodsId, 5)\r\n      this.commentList = list\r\n      this.total = total\r\n    },\r\n    addFn () {\r\n      this.mode = 'cart'\r\n      this.showPannel = true\r\n    },\r\n    buyFn () {\r\n      this.mode = 'buyNow'\r\n      this.showPannel = true\r\n    },\r\n    async addCart () {\r\n      // 判断 token 是否存在\r\n      // 1.如果token不存在，弹确认框\r\n      // 2.如果token存在，继续请求操作\r\n      if (!this.$store.getters.token) {\r\n        // 弹确认框\r\n        Dialog.confirm({\r\n          title: '温馨提示',\r\n          message: '此时需要先登录才能继续操作哟！',\r\n          confirmButtonText: '去登录',\r\n          cancelButtonText: '再逛逛'\r\n        }).then(() => {\r\n          // 如果希望，跳转到登录 => 登录后能 跳转 回来，需要在跳转时去携带参数（当前的路径地址）\r\n          // this.$route.fullPath：会包含查询参数\r\n          this.$router.replace({\r\n            path: '/login',\r\n            query: {\r\n              backUrl: this.$route.fullPath\r\n            }\r\n          })\r\n        }).catch(() => {})\r\n        return\r\n      }\r\n      const { data } = await addCart(this.goodsId, this.addCount, this.detail.skuList[0].goods_sku_id)\r\n      this.cartTotal = data.cartTotal\r\n      Toast('加入购物车')\r\n      this.showPannel = false\r\n      console.log(this.cartTotal)\r\n    },\r\n    goBuyNow () {\r\n      this.$router.push({\r\n        path: '/pay',\r\n        query: {\r\n          mode: 'buyNow',\r\n          goodsId: this.goodsId,\r\n          goodsSkuId: this.detail.skuList[0].goods_sku_id,\r\n          goodNum: this.addCount\r\n        }\r\n      })\r\n    }\r\n  },\r\n  components: {\r\n    CountBox\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n@import '@/styles/css/goods.css';\r\n</style>\r\n"],"mappings":";;;;;AAoFA,SAAAA,cAAA,EAAAC,YAAA;AACA,OAAAC,UAAA;AACA,OAAAC,QAAA;AAEA,SAAAC,OAAA;AACA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,MAAA;MACAC,MAAA;MACAC,IAAA;MACAC,KAAA;MAAA;MACAC,WAAA;MAAA;MACAT,UAAA;MACAU,UAAA;MAAA;MACAC,IAAA;MACAC,QAAA;MAAA;MACAC,SAAA;IACA;EACA;EACAC,QAAA;IACAC,QAAA;MACA,YAAAC,MAAA,CAAAC,MAAA,CAAAC,EAAA;IACA;EACA;EACAC,QAAA;IACA,KAAAC,SAAA;IACA,KAAAC,WAAA;EACA;EACAC,OAAA;IACAC,SAAA;MACA,KAAAhB,IAAA;MACA,SAAAA,IAAA,QAAAD,MAAA,CAAAkB,MAAA;QACA,KAAAjB,IAAA;MACA;IACA;IACA,MAAAa,UAAA;MACA;QAAAhB,IAAA;UAAAC;QAAA;MAAA,UAAAN,YAAA,MAAAgB,OAAA;MACA,KAAAV,MAAA,GAAAA,MAAA;MACA,KAAAC,MAAA,GAAAD,MAAA,CAAAoB,YAAA;IACA;IACA,MAAAJ,YAAA;MACA;QAAAjB,IAAA;UAAAsB,IAAA;UAAAlB;QAAA;MAAA,UAAAV,cAAA,MAAAiB,OAAA;MACA,KAAAN,WAAA,GAAAiB,IAAA;MACA,KAAAlB,KAAA,GAAAA,KAAA;IACA;IACAmB,MAAA;MACA,KAAAhB,IAAA;MACA,KAAAD,UAAA;IACA;IACAkB,MAAA;MACA,KAAAjB,IAAA;MACA,KAAAD,UAAA;IACA;IACA,MAAAR,QAAA;MACA;MACA;MACA;MACA,UAAA2B,MAAA,CAAAC,OAAA,CAAAC,KAAA;QACA;QACAC,OAAA,CAAAC,OAAA;UACAC,KAAA;UACAC,OAAA;UACAC,iBAAA;UACAC,gBAAA;QACA,GAAAC,IAAA;UACA;UACA;UACA,KAAAC,OAAA,CAAAC,OAAA;YACAC,IAAA;YACAC,KAAA;cACAC,OAAA,OAAA3B,MAAA,CAAA4B;YACA;UACA;QACA,GAAAC,KAAA;QACA;MACA;MACA;QAAAzC;MAAA,UAAAF,OAAA,MAAAa,OAAA,OAAAH,QAAA,OAAAP,MAAA,CAAAyC,OAAA,IAAAC,YAAA;MACA,KAAAlC,SAAA,GAAAT,IAAA,CAAAS,SAAA;MACAmC,MAAA;MACA,KAAAtC,UAAA;MACAuC,OAAA,CAAAC,GAAA,MAAArC,SAAA;IACA;IACAsC,SAAA;MACA,KAAAZ,OAAA,CAAAa,IAAA;QACAX,IAAA;QACAC,KAAA;UACA/B,IAAA;UACAI,OAAA,OAAAA,OAAA;UACAsC,UAAA,OAAAhD,MAAA,CAAAyC,OAAA,IAAAC,YAAA;UACAO,OAAA,OAAA1C;QACA;MACA;IACA;EACA;EACA2C,UAAA;IACAtD;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}